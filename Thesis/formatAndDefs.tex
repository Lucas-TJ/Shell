\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[left=3.8cm,right=3.3cm,top=2.8cm,bottom=2.8cm,includefoot,includehead,headheight=13.6pt]{geometry}
\renewcommand{\baselinestretch}{1.05}



% ------------------------------------------------------------------------------------------------------------------
%   Nomenclature and bibliography settings
% ------------------------------------------------------------------------------------------------------------------

% Glossary / list of abbreviations
%\usepackage[intoc]{nomencl}
%\renewcommand{\nomname}{List of Abbreviations}
%\makenomenclature
% Help
% Issue the \nomenclature command for each symbol you want to have included in the nomenclature list. The best place for this command is immediately after you introduce the symbol for the first  time. Put \printnomenclature at the place you want to have your nomenclature list. Option "refpage" to add page numbers.
% Example: PhD\nomenclature{PhD}{Doctor of Philosophy} 


% Natbib adds different possibilities for citations. \cite{ref} => Name et al. (xxxx) ; \citepref} => (Name et al., xxxx) ; \citep[prefix][suffix]{ref} => (prefix Name et al., xxxx, suffix) ; 
\usepackage{natbib}	
\defcitealias{OpenGL}{OpenGL}

% Creates a label in front of each item of the bibliography based on Author-year.
\makeatletter
\def\@lbibitem[#1]#2{%
\if\relax\@extra@b@citeb\relax\else
\@ifundefined{br@#2\@extra@b@citeb}{}{%
\@namedef{br@#2}{\@nameuse{br@#2\@extra@b@citeb}}}\fi
\@ifundefined{b@#2\@extra@b@citeb}{\def\NAT@num{}}{\NAT@parse{#2}}%
\item[\hfil\hyper@natanchorstart{#2\@extra@b@citeb}{[{\citealp{#2}}]}%
\hyper@natanchorend]%
\NAT@ifcmd#1(@)(@)\@nil{#2}}
\makeatother

% ------------------------------------------------------------------------------------------------------------------
%   Pdf configuration
% ------------------------------------------------------------------------------------------------------------------
\usepackage{ifpdf}

\ifpdf
  \usepackage[pdftex]{graphicx}
  \DeclareGraphicsExtensions{.jpg,.pdf,.png}
  \usepackage[a4paper]{hyperref}
\else
  \usepackage{graphicx}
  \DeclareGraphicsExtensions{.ps,.eps}
  \usepackage[a4paper,dvipdfm]{hyperref}
\fi

\graphicspath{{.}{images/}}

% Links in pdf
\usepackage{color}
\definecolor{linkcol}{rgb}{0.65, 0.07, 0.07}		%  {0.65, 0.07, 0.07}
\definecolor{citecol}{rgb}{0.65, 0.07, 0.07} 	%  {0.65, 0.07, 0.07}


% Change this to change the informations included in the pdf file (see hyperref documentation for information on those parameters)
\hypersetup
{
pdftitle="Real-time soft tissue modelling on GPU for medical simulation", % Sets the document information Title field
pdfauthor="Olivier COMAS", % Sets the document information Author field
pdfpagelayout=SinglePage, % Sets layout of PDF pages ('SinglePage' displays a single page)
pdffitwindow=true, % Resize document window to fit document size
linktocpage=true, % make page number, not text, be link on TOC, LOF and LOT
colorlinks=true, % Colors the text of links and anchors
linkcolor=linkcol, % Color for normal internal links
citecolor=citecol, % Color for bibliographical citations in text
urlcolor=linkcol % Color for linked URLs
}

% To get the link in the table of figures point to the top of the image (instead of the caption by default)
\usepackage[all]{hypcap}

% The tocbibind package enables the titles of the Table of Contents, the List of Figures, the List of Tables, the Bibliography and the Index all to be correctly added to the Table of Contents.
\usepackage[notlot,notlof]{tocbibind}
% The tocvsec2 package provides means of controlling the sectional numbering and/or the entries in the Table of Contents on a section by section basis.
\usepackage{tocvsec2}

% Implements a new bookmark (outline) organisation for package hyperref. Only one LaTeX pass is sufficient (instead of 2 by hyperref)
%\usepackage{bookmark}

% ------------------------------------------------------------------------------------------------------------------
%   Definitions
% ------------------------------------------------------------------------------------------------------------------
\setcounter{secnumdepth}{3}				% Change the depth to which section numbering occurs
\setcounter{tocdepth}{2} 					% Specifies what depth to take the Table of Contents to

% Some useful commands and shortcut for maths:  partial derivative and stuff
\newcommand{\pd}[2]{\dfrac{\partial #1}{\partial #2}}

% Figure references \fig{label} => Fig.~ref{label}
\newcommand{\fig}[1]{Fig.~\ref{#1}}

% Left superscript
\usepackage{leftidx}

\usepackage{rotating}                    				% Sideways of figures & tables
\usepackage{bibentry}									% Allows the insertion of bibliography entries
\nobibliography*
\usepackage{enumitem}								% Custom enumerate environments
                                         
\usepackage{multirow}									% Multirows in tables
%\usepackage{slashbox}								% Diagonal separation in corner cells of tables

% For maths
\usepackage{amsmath}             						% Provides miscellaneous enhancements for mathematical formulas
\usepackage{amsfonts}
\newcommand{\field}[1]{\mathbb{#1}}			% For sets of reals, complex etc. 
  
% For snipsets of code
\usepackage{listings}
\usepackage{textcomp}
\definecolor{listinggray}{gray}{0.9}
\definecolor{lbcolor}{rgb}{0.9,0.9,0.9}
\lstset{
	language=C++,
	keywordstyle=\bfseries\ttfamily\color[rgb]{0,0,1},
	identifierstyle=\ttfamily,
	commentstyle=\color[rgb]{0.133,0.545,0.133},
	stringstyle=\ttfamily\color[rgb]{0.627,0.126,0.941},
	showstringspaces=false,
	basicstyle=\small,
	numberstyle=\footnotesize,
	numbers=left,
	stepnumber=1,
	numbersep=10pt,
	tabsize=2,
	breaklines=true,
	prebreak = \raisebox{0ex}[0ex][0ex]{\ensuremath{\hookleftarrow}},
	breakatwhitespace=false,
	aboveskip={1.5\baselineskip},
  columns=fixed,
  upquote=true,
  extendedchars=true,
 frame=single,
emph={Vec3d,Quat},
emphstyle=\bfseries\ttfamily\color[rgb]{0,0,1}
% backgroundcolor=\color{lbcolor},
}

% Two definitions for chapter 9
\newcommand{\JNL}{\ensuremath{\mathcal{J}}}     % positions
\newcommand{\J}{\ensuremath{J}}     					% linear mapping


% For sub-captions in figures
\usepackage{caption}
\usepackage{subfig}


 % Short text in italic put between two lines for a short abstract before each chapter
\newenvironment{shortAbstract}
{\vspace{\stretch{1}} \noindent\rule[2pt]{\textwidth}{0.5pt} \it}									% Before environment
{\newline \noindent\rule[2pt]{\textwidth}{0.5pt} \vspace{\stretch{3}} \newpage}		% After environment


% Centered page environment used for abstracts at the end of the manuscript
%\newenvironment{vcenterpage}
%{\newpage\vspace*{\fill}\thispagestyle{empty}\renewcommand{\headrulewidth}{0pt}}
%{\vspace*{\fill}}


% ------------------------------------------------------------------------------------------------------------------
%   Headers configuration
% ------------------------------------------------------------------------------------------------------------------
\usepackage{fancyhdr}				% Fancy Header Style Options
\pagestyle{fancy}                       % Sets fancy header and footer

\fancyhead{}														 % Clear all head fields
\fancyhead[RE]{\nouppercase{\leftmark}} 		     % Chapter at the right on even pages
\fancyhead[LE]{\thepage}									 % Page number at the left on even pages
\fancyhead[LO]{\nouppercase{\rightmark}}    	 % Section at the left on odd pages
\fancyhead[RO]{\thepage}									 % Page number at the right on odd pages
\fancyfoot{}														 % Clear all footer fields

\let\headruleORIG\headrule
\renewcommand{\headrule}{\color{black} \headruleORIG}
\renewcommand{\headrulewidth}{1.0pt}
\usepackage{colortbl}
\arrayrulecolor{black}

% Redefine style "plain" used by chapter pages
\fancypagestyle{plain}
{
  \fancyhead{}
  \fancyfoot{}
  \renewcommand{\headrulewidth}{0pt}
}


% ------------------------------------------------------------------------------------------------------------------
%   Clear Header Style on the Last Empty Odd pages
% ------------------------------------------------------------------------------------------------------------------
\makeatletter

\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else%
  \hbox{}%
  \thispagestyle{empty}%              % Empty header styles
  \newpage%
  \if@twocolumn\hbox{}\newpage\fi\fi\fi}

\makeatother



% ------------------------------------------------------------------------------------------------------------------
%   Fancy chapter titles
% ------------------------------------------------------------------------------------------------------------------
%\usepackage[Lenny]{fncychap}			% Lenny, Bjornstrup
% WARNING: screwed the table of contents up (problem with \appendix)
% Using \chapter*{Appendix Example}\label{chap:appendix1} \phantomsection \addcontentsline{toc}{chapter}{Appendix Example} instead of chapter{Appendix Example} fixes the problem as well

\makeatletter

\def\thickhrulefill{\leavevmode \leaders \hrule height 1ex \hfill \kern \z@}
\def\@makechapterhead#1{%
  {\parindent \z@ \raggedright
    \reset@font
    \hrule
    \vspace*{10\p@}%
    \par
    \Large \scshape \@chapapp{} \Huge\bfseries \thechapter
    \par\nobreak
    \vspace*{10\p@}%
    \hrule
    \par
    \vspace*{1\p@}%
    \hrule
    \vspace*{20\p@}
    \Huge \bfseries #1\par\nobreak
    \vskip 70\p@
  }}
  
\makeatother

% ------------------------------------------------------------------------------------------------------------------
%   Draft stuff during redaction
% ------------------------------------------------------------------------------------------------------------------

% For comments and TODO (merely writes in colour)
\newcommand{\OC}[1]{\color{blue}{\textnormal{(#1)}} \color{black}}
\newcommand{\TODO}[1]{\color{red}{TODO: #1} \color{black}}
\newcommand{\ON}{\color{blue}}
\newcommand{\OFF}{\color{black}}

% To display current time (\currenttime) and change format of date
\usepackage[dayofweek]{datetime}
\settimeformat{xxivtime}					% twenty-four hour time like 16:51

% Defines a new date format as Tue 13th of July 2010
\newdateformat{mydateformat}{\shortdayofweekname{\THEDAY}{\THEMONTH}{\THEYEAR} \ordinaldate{\THEDAY}~of \monthname[\THEMONTH] \THEYEAR}
\mydateformat

% Watermarks the document
\usepackage{type1cm,eso-pic}
\makeatletter
\AddToShipoutPicture{%
\setlength{\@tempdimb}{.5\paperwidth}%
\setlength{\@tempdimc}{.5\paperheight}%
\setlength{\unitlength}{1pt}%
\put(\strip@pt\@tempdimb,\strip@pt\@tempdimc){%
\makebox(0,0){\rotatebox{45}{\textcolor[gray]{0.9}%
{\fontsize{3cm}{3cm}\selectfont{Draft Version}}}}%
\makebox(-500,-0){\rotatebox{90}{\textcolor[gray]{0.9}%
{\fontsize{0.7cm}{0.7cm}\selectfont{Olivier Comas - \today ~at \currenttime}}}}
}%
}
\makeatother
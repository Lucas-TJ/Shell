% TODO
% REMEMBER: After having produced the .bbl file, and prior to final submission,
% you need to 'insert'  your .bbl file into your source .tex file so as to provide
% ONE 'self-contained' source file.

\documentclass{acm_proc_article-sp}

\usepackage{caption}
\DeclareCaptionType{copyrightbox}
\usepackage{amsmath}
%\usepackage{makeidx}
%\usepackage[pdftex]{graphicx} ... we have to use ps/eps
\usepackage{subfig}

\def\wrt{w.\,r.\,t.}
\def\eg{e.\,g.}
\def\ie{i.\,e.}
\def\Dash{\nobreak\,---\penalty-500\,}

%%% Comments
\usepackage{color}
\newcommand{\TG}[1]{{\color{blue}\textbf{TG: #1}}}
\newcommand{\CD}[1]{{\color{green}\textbf{CD: #1}}}
\newcommand{\IP}[1]{{\color{cyan}\textbf{IP: #1}}}
\newcommand{\TODO}[1]{{\color{red}\textbf{TODO: #1}}}
%%%

\renewcommand{\Vec}[1]{\mathbf{#1}}
\newcommand{\Mat}[1]{\mathbf{#1}}

\begin{document}

\title{Modeling Liver with Glisson's Capsule in Real-Time Medical Simulations}
%\subtitle{}

\numberofauthors{4}
\author{
% 1st. author
\alignauthor
Tom\'a\v{s} Golembiovsk\'y\\
       \affaddr{Faculty of Informatics}\\
       \affaddr{Masaryk University}\\
       \affaddr{Brno, Czech Republic}\\
       \email{nyoxi@ics.muni.cz}
% 2nd. author
\alignauthor
Igor Peterl\'ik\\
       \affaddr{Institut Hospitalo-Universitaire}\\
       \affaddr{Strasbourg, France}\\
       \email{Igor.Peterlik@ihu-strasbourg.eu} % TODO
% 3rd. author
\alignauthor
Christian Duriez\\
       \affaddr{INRIA}\\
       \affaddr{Lille, France}\\
       \email{Christian.Duriez@inria.fr} % TODO
\and
% 4th. author
\alignauthor
Stephan\'e Cotin\\
       \affaddr{INRIA}\\
       \affaddr{Lille, France}\\
       \email{Stephane.Cotin@inria.fr} % TODO
}

%\date{30 May 2013}

\maketitle
\begin{abstract}
  \TODO{}
The accurate mechanical modeling of liver is of a paramount interest in simulation-based operation planning 
and computer-aided per-operative guidance. However, the realistic simulation of liver behaviour is a challenging task, 
since the organ is composed of three constituents: parenchyma, vascularization and Glisson's capsule, 
each having different mechanical properties. 

While a real-time simulation of vascularized liver has been already described in~\cite{Peterlik2012}, the Glisson's 
capsule has not been included in the modeling. In~\cite{Hollenstein2006,Ahn2010} it is shown that the capsule 
plays an important role mainly in the vicinity of the surgical tools. Therefore, the accuracy of the liver response 
in the vicinity of the surgical tool requires correct modeling of the capsule as a component of the liver model. 

The measures perfomed on the capsule show report stiffness which is significanly higher that that of the parenchyma, however, 
the thickness of the membrane does not exceed 100$\mu$m. For this reasons, it is not possible to model the 
capsule with standard volume elements usually employed for the parenchyma. In our approach, we rely of 
corotational membrane elements based on constant-strain formulation, which are coupled mechanically to the underlying 
tetrahedra. We show that using this model we are able to reproduce the experiments reported in~\cite{Hollenstein2006}, 
while maintaining the real-time aspect of the simulation. 

%This work provides a complete physical model for the deformations of the liver with its three constituents: parenchyma, vessels and the Glisson's capsule.
%Some recent experimental results \cite{Ahn2010} have shown that there is a significant difference of stiffness between the Glisson's capsule and the parenchyma. 
%Moreover, it has been observed that the capsule plays an important role for the deformation at the local level \cite{Hollenstein2006}.
%However, the Glisson's capsule is very thin and its influence for the global deformations of the liver was never highlighted.
%In this work, we propose to use a membrane FEM model for the capsule, that is coupled with a vascularized model of the liver.
%We show that the approach is able to reproduce the deformations observed at the local level.
%Additionally, we show, by simulating natural global deformations of the liver observed on real images (due to gravity), that the results have important differences with and without the capsule.

\end{abstract}

% TODO
% A category with the (minimum) three required fields
\category{H.4}{Information Systems Applications}{Miscellaneous}
%A category including the fourth, optional field follows...
\category{D.2.8}{Software Engineering}{Metrics}[complexity measures, performance measures]

\terms{Theory} %TODO

% NOT required for Proceedings
%\keywords{deformable liver model, Glisson's capsule, real-time soft tissue modeling}
\keywords{deformable liver model}

\section{Introduction} %{{{

According to the statistics, nearly 100,000 European citizens die of cirrhosis or liver cancer each year. 
Although new methods such as radio-frequency- and cryo-ablation known in the interventional radiology 
seem to be promising, surgery remains the option that offers the foremost success rate against these pathologies. 
Nevertheless, surgery is not always performed due to several limitations, in particular the determination 
of accurate eligibility criteria for the patient. 
In this context, the pre-operational planning becomes a crucial task having a significant impact on the treatment. 

Computer-aided physics-based medical simulation has proven to be an extremely useful technique in the area of medical training. 
Nevertheless, whereas generic models are usually required in training simulators, accurate patient-specific modelling
becomes necessary as soon as computer simulation is to be employed in the pre-operative planning. At the same time, 
interactivity of such models remains an important aspect, requiring real-time simulation which is often difficult to 
achieve given the complexity of soft tissues. 

When simulating the behavior of human liver, the task of real-time accurate modeling is challenging, mainly because of the complex structure 
of this organ composed of three main constituents: \emph{parenchyma}, \emph{vascular networks} and \emph{Glisson's capsule}.
The parenchyma has certainly been the most studied component of the liver; actually researchers agree on hyperelastic 
properties of the tissue, for which the mechanical parameters have been reported for example in~\cite{Kerdok2006,Gao2009}. 
Moreover, several methods have been proposed to model the hyperelastic behaviour at real-time rates, such as multiplicative Jacobian decomposition
introduced in~\cite{Marchesseau2010}.

\TG{The following paragraph is optional. Unnecessary but adds to the global context}
The mechanical importance of the vascular structures in liver is studied in~\cite{Peterlik2012}. It shows that the 
influence of vessels on the mechanical behaviour of the organ is significant. %, mainly if large deformations occur. 
%Since a detailed modeling of the vessels would be extremely costly (mainly because of the small thickness of the vessel wall, 
%the authors propose a composite model allowing for real-time simulation of entire liver with vascularization.
Since a detailed modeling of the vessels would be extremely costly (mainly because of the small thickness of the vessel wall, 
the authors propose a composite model allowing for real-time simulation.


Rather a small number of studies have been conducted dealing with the third liver constituent, the  Glisson's capsule.
Quantitative results of experiments on a porcine liver have been published in~\cite{Umale2011}; the measurements indicate that although being very 
thin (10--20$\mu m$), the capsule shows to be stiff in tensile tests: the Young's modulus of the capsule reported to be $8.22\pm3.42$\,MPa 
exceeds the values for the parenchyma by three orders of magnitude.
This suggests that the mechanical influence of the membrane on the liver behaviour is not negligible.

In~\cite{Hollenstein2006}, a local influence of the capsule has been measured using a special aspiration device. The study was then repeated 
in vivo on human patients during the operation, confirming the mechanical importance of the membrane~\cite{Ahn2010,Nava2008}.
%To our best knowledge, no attempt has been made to demonstrate the role of the Glisson's capsule on the global behaviour of 
%the liver, mainly if the organ undergoes large deformations which is often the case during the surgery.

In this paper we present preliminary results of our work on the complete liver
model. We present a real-time composite model accounting for parenchyma and
Glisson's capsule. The model is based on two different finite element
representations for each constituent coupled together.
%The main contribution of the paper is twofold: first, we present a real-time model of the liver, including
%the parenchyma, vascularization and Glisson's capsule. The model is based on three different finite element representations for each constituent,
%linked together via mechanical coupling.
We show that the model mimics the \emph{local} experiments described in~\cite{Hollenstein2006}.
 
%Second, we use the complete model of the liver to demonstrate the \emph{global} influence of the Glisson's
%capsule via simulation: using a specific model of a porcine liver built from CT contrast-enhanced data, we show that there is a significant 
%difference in the response of the model with and without the capsule in the case when the liver undergoes large deformations. 

The paper is organized as follows: first we describe the proposed model of
liver with capsule. Second, we validate our model in context of local
deformations by reproducing the aspiration test described
in~\cite{Hollenstein2006}. We conclude by summarizing future steps towards the
complete liver model.
%Finally, we demonstrate that in spite of its small thickness, the Glisson's 
%capsule has a global influence on the liver undergoing large deformations. 


%}}}


\section{Model} %{{{

In this section we describe the construction of a composite model
based on two components: tetrahedral FE model of the 
parenchyma and
triangular membrane elements used for the capsule.

\subsection{Parenchyma} %{{{

It is known that the parenchyma exhibits non-linear viscoelastic behaviour \cite{Marchesseau2010}.
However, as we are mainly interested in the static equilibrium, we do not model the time-dependent
phenomena related to viscosity.

%However, we employ simpler corotational model as we are not so much
%interested in time-dependent behaviour but rather in static equilibrium
%under certain conditions.
%We also rely on the vascularized model of the parenchyma proposed by
%Peterl\'{i}k et al. \cite{Peterlik2012}.

The parenchyma is modeled using corotational finite elements~\cite{Felippa2005}.
Although it relies on linear stress-strain relationship, large displacements including rotations are modelled correctly. 
While in the full non-linear formulation the stiffness matrix relates the forces $\Vec{f}$ and 
displacements $\Vec{u}$ as $\Vec{f} = K(\Vec{u})$, the corotational model 
requires the stiffness matrix $\Mat{K}_0$ of the system to be computed only once before the simulation begins. 
Then, in each step, the motion of each element $e$ is decomposed into rigid rotation $\Mat{R}^e$ and local deformation. 
The rotations are then used to update each local element stiffness matrix as $\Mat{R}\Mat{K}_0\Mat{R}^{\top}$
whereas the deformations are used to compute the linear strain in the local corotational frame.
There are several ways of computing the corotational frame for elements; we rely on
the geometrical method proposed in \cite{Nesme2005}.
% NOTE: This description of corotational method is very simplified and could be extended.

%The model of the vascularization is based on linear beams 
%with local frames of reference~\cite{Duriez2006}; in many aspects it's similar to the
%corotational formulation described above. As such the model also handles geometric
%non-linearities in the deformation. Through a specification of cross section and moments of inertia, 
%the model can account for the specific properties of the blood vessels. 

%The beam-based model of vessels is mechanically coupled to the parenchyma as described in~\cite{Peterlik2012}. 
%The coupling assumes that there is no relative motion between the vessels and the surrounding parenchyma. 
%During the simulation, the nodes of linked beams are first displaced and rotated according to the actual motion of associated tetrahedra. 
%As the deformation of beams results in mechanical response represented by forces and torques, these are propagated back to 
%the tetrahedral FE model. 

%}}}

\subsection{Glisson's Capsule} %{{{
\label{ss:capsuleModel}
The thickness of the Glisson's capsule is relatively small: the values in range of 10-20
$\mu$m have been reported in~\cite{Umale2011}.
It is not possible to model such thin structure with classical tetrahedral
elements, if the real-time aspect of the simulation is to be preserved.
Furthermore, modeling both the tissue and the capsule would require an extremely 
dense mesh to avoid numerical instabilities and thus would significantly
violate the speed requirements imposed for medical simulators.
Instead, modeling the capsule with two-dimensional elements that abstract from the
thickness in the third dimension seems
to be a natural choice. In the elasticity theory, this functionality is usually provided by membrane and shell elements.
Based on the observation of its behaviour, we also
assume negligible bending forces and propose a model based on membrane
elements. 
To maintain simplicity of the composite model we choose simple triangular
elements with constant strain (CST).

The computation of elastic stiffness matrix follows the common derivation
%
\begin{eqnarray}
  \Mat{K}^m & = & \int_V \Mat{B}^T \Mat{E} \Mat{B} dV     \label{mem1} \\
            & = & h \int_A \Mat{B}^T \Mat{E} \Mat{B} dA   \label{mem2} \\
            & = & h A \Mat{B}^T \Mat{E} \Mat{B}           \label{mem3}
\end{eqnarray}
%
where $\Mat{B}$ is the strain-displacement matrix, $\Mat{E}$ the material
matrix, $h$ is the thickness and $A$ area of the element. In the previous
\eqref{mem2} follows from the fact that we assume constant thickness of the
element and \eqref{mem3} follows from the fact that the strain-displacement
matrix is constant in our case. The strain-displacement matrix for the CST
element can be expressed as:
%
\begin{equation}
  \Mat{B} = \frac{1}{2A} \begin{bmatrix}
    y_{23} & 0      & y_{31} & 0      & y_{12} & 0 \\
         0 & x_{32} & 0      & x_{13} & 0      & x_{21} \\
    x_{32} & y_{23} & x_{13} & y_{31} & x_{21} & y_{12}
  \end{bmatrix}
\end{equation}
%
The values $x_{ij} = x_i - x_j$ and $y_{ij} = y_i - y_j$ are computed from
the $x$ or $y$ coordinates of the nodes $i,j$ of the triangular element.
The reader can refer to the respective literature for more thorough
description~\cite{Felippa2003}.

Similarly as with model of parenchyma we use linear elastic material and employ
the corotational formulation for the CST elements.

%}}}

\subsection{Coupling Between Capsule and\\Parenchyma} %{{{
The literature reports high cohesion between capsule and parenchyma.
Based on this property we assume there is no relative motion of the capsule \wrt\ the parenchyma.
Although an arbitrary surface mesh could be used to model the capsule, we exploit 
the fact that the parenchyma is modeled by tetrahedral elements having
triangular faces. Thus, as the boundary of the volumetric mesh is already
triangulated, we simply employ the triangles on the mesh surface to model the capsule.

Using directly the boundary of the tetrahedral mesh does not only solve the
problem of building the surface mesh, but has one more advantage: the nodes
of the triangular mesh coincide with the nodes of the tetrahedral mesh, so no projection of one mesh onto the other is needed.
Moreover, the stiffness matrices for capsule and parenchyma are then easily assembled
together.
% and solved as one system.
%
%\CD{The following may appear as "trivial"... maybe we can remove this part at the end if we need space} 
%Without the loss of generality we can assume the tetrahedron consists of
%nodes $p_1, p_2, p_3$ and $p_4$ and the boundary triangle has nodes $p_1, p_2$
%and $p_3$. We can reorder the degrees of freedom so that the stiffness
%matrix $\Mat{K}^t$ for the tetrahedron can be written as:
%%
%\begin{equation}
%  \Mat{K}^t = \left[\begin{array}{c|c}
%      \Mat{K}^t_{1-3,1-3} & \Mat{K}^t_{1-3,4} \\
%      \hline
%      \Mat{K}^t_{4,1-3} & \Mat{K}^t_{4,4} \\
%  \end{array}\right]
%\end{equation}
%%
%Then the assembled stiffness matrix for the element is:
%%
%\begin{equation}
%  \Mat{K} = \left[\begin{array}{c|c}
%      \Mat{K}^t_{1-3,1-3} & \Mat{K}^t_{1-3,4} \\
%      \hline
%      \Mat{K}^t_{4,1-3} & \Mat{K}^t_{4,4} \\
%  \end{array}\right]
%  +
%  \left[\begin{array}{c|c}
%      \Mat{K}^m & 0 \\
%      \hline
%      0 & 0 \\
%  \end{array}\right]
%\end{equation}
%%
%Where $\Mat{K}^m$ is the stiffness matrix of the triangular membrane.
The resulting system of linear equations is solved by direct solver based on Cholesky decomposition.

Alternatively, one can use a mechanical coupling similar to the one used in
\cite{Peterlik2012} to be able to use an arbitrary surface mesh. Nevertheless,
for conforming triangular mesh both methods lead to the same solution.

%}}}

%}}}


\section{Methods and Simulation} %{{{

The model presented in the previous section was implemented in 
SOFA\footnote{www.sofa-framework.org} and a set of
numerical simulations was performed.
In this section we provide comparison of local deformations with the
results reported in literature to validate the method.
%Second, to show that in spite of its very small thickness the membrane cannot be
%neglected even in the context of global deformations and its overall
%stiffness plays an important role, the model of
%the complete liver was subjected to global deformations.

During the contact with an instrument such as probe, needle, scalpel and others,
a specific deformations take place in the vicinity of
the instrument. This type of deformation may not necessarily induce the
deformation of the object as a whole and therefore can be considered as
local. Correct material properties are not only important to quantify the
displacement, but also play an important role in capturing the correct area of
the deformation or its profile near the instrument.

\begin{figure}
  \centering
  \includegraphics[height=3.5cm]{aspiration.jpg}
  \caption{\label{fig-aspiration1} The SOFA simulation scene of the aspiration test.}
\end{figure}

A good example of such a local deformation is the aspiration test
where the response of liver exposed locally to a negative pressure is measured.
The aspiration device consists of a tube 1\,cm in diameter and allows
control of internal pressure in the tube. The test is performed by
attaching the tube to the tissue and measuring the tissue response. We
set up a simulation in SOFA to reproduce the experiment (see
Fig.~\ref{fig-aspiration1}: we meshed a 15$\times$15$\times$15\,mm$^3$ 
cube representing the tissue 
resulting in 2648 tetrahedra. Then we attached a 1\,cm tube 
and applied a pressure of 3\,kPa inside the tube. The interaction between the tube and 
tissue was modelled with friction contact. 

In the simulations we used material properties for a pig liver reported in the literature: for the 
Glisson's capsule we used Young's modulus $E_c$=8.22\,MPa and thickness $t_c$=20\,$\mu$m~\cite{Umale2011}.
Since the values for parenchyma elasticity quite vary (usually between 2\,kPa to 5\,kPa), we perform the simulation 
with $E_p$=3.5\,kPa.

%}}}


\section{Results and Discussion} %{{{

\begin{figure}
  \centering
  \includegraphics[width=7cm]{aspiration.pdf}
  \caption{\label{fig-aspiration2} Displacement profile of the cube in the
  aspiration test with (blue) and without (black) the capusle.}
\end{figure}

In~\cite{Hollenstein2006} it is reported that the Glisson's
capsule has a non-negligible influence on the response of the tissue and modeling
only the parenchyma leads to an overestimation of the deformation by a factor of 2 to 3. 
In Fig.~\ref{fig-aspiration2} the profiles of cuts in the middle of the
test cube are presented showing significantly larger deformation in the model without capsule.
We can indeed observere that the deformation without the capsule is indeed overestimated approximately by a factor of 2. This is in perfect agreement with the results reported in the paper.% ~\cite{Hollenstein2006}

Moreover, we are able to reproduce
the measurements presented in~\cite{Hollenstein2006,Nava2008} with less than 1\% error.
We do not model the time-dependent behaviour though.
In this simulation we prescribe the the internal pressure of 30\,kPa. The other
parameters of the model were obtained like this: First we fix the stiffness of
parenchyma to $E_p$=30\,kPa to match the scenerio without capsule. Then,
assuming the thickness $t$=93\,$\mu$m of the capsule (reported as average in
the paper) we run several simulations with different capsule stiffness $E_c$.
We have found the lowest error is when $E_c$=3\,MPa. All the stiffness
parameters lie within the ranges measured in the paper.

%In this case the simulation was performed with the pressure of 30\,kPa and with
%the following elastic parameters: $E_p$=30\,kPa for parenchyma and $E_c$=3\,MPa
%and $t$=93\,$\mu$m for capsule.
%All the values lie within the measurements
%specified in the paper. \TG{add figure like Fig. 2?}

%The influence of the capsule on local level has been published in literature
%before. However, to our knowledge it's influence on global scale deformation
%has not been studied yet. We believe that the capsule has non-negligible impact
%also on global level. 

Our goal is to create complete liver model suitable for real-time medical
simulations. For this a model accounting for all three main constituents
(parenchyma, vascularization and capsule) is necessary. To achieve that we have
integrated our model with the vasularization method proposed
in~\cite{Peterlik2012}. Adding the capsule did not signifficantly affect the
performance since simulation speed of \TODO{XX FPS}%
\footnote{\TODO{Measured on...}} was achieved. This suggests
that the proposed technique is compatible with real-time simulation of whole
organ while modeling the local properties accurately.

%In our future work we need to validate the model in the
%context of global and local deformations. This task is challenging because
%comparing in vivo measurements with the simulation is difficult due to complex
%boundary conditions. 
%\TG{ex-vivo: no information abou vessels; phantoms: cannot model capsule}

%}}}

\section{Conclusions and Future Work} %{{{

In the paper we presented a liver model accounting for the Glisson's capsule, a component that is often overlooked. Each constituent being modelled with a different type 
of finite elements: tetrahedral corotational model used for the parenchyma and
and CST membrane elements used for the capsule. 
The model was validated in the context for local displacements based on the the aspiration test presented in~\cite{Hollenstein2006}. The aspiration test
was successfully reproduced, showing a good agreement between the simulation and experiments. 

Presently we are focusing on the validation of the model also in context of
global deformations of the organ where we believe the capsule also plays an
essential role. This task is however complicated by the lack of biomechanical
literature dealing with the response of the capsule.

%Further, the model was used to demonstrate global influence of the capsule when the organ 
%undergoes large deformations. 

%In the future work, we plan to employ the proposed model for other organs where the capsule play an important role
%(for example kidneys). We will also focus on better description of the mechanical interactions and couplings among the organs and tissues in the abdominal 
%cavity via realistic modeling of boundary conditions using mechanical constraints and contacts.

%}}}

%
% ---- Bibliography ----
%

\bibliographystyle{abbrv}
\bibliography{bibdata}

\end{document}
% spell: setl spell spelllang=en spellfile=spelldict.en.utf-8.add
% vim:set et sw=2 fdm=marker fdl=3 fdc=4 isk+=_,-:

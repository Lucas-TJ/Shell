%%%%%%%%%%%%%%%%%%%%%%% file typeinst.tex %%%%%%%%%%%%%%%%%%%%%%%%%
%
% This is the LaTeX source for the instructions to authors using
% the LaTeX document class 'llncs.cls' for contributions to
% the Lecture Notes in Computer Sciences series.
% http://www.springer.com/lncs       Springer Heidelberg 2006/05/04
%
% It may be used as a template for your own input - copy it
% to a new file with a new name and use it as the basis
% for your article.
%
% NB: the document class 'llncs' has its own and detailed documentation, see
% ftp://ftp.springer.de/data/pubftp/pub/tex/latex/llncs/latex2e/llncsdoc.pdf
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\documentclass[runningheads,a4paper]{llncs}

\usepackage[colorlinks=true,linkcolor=black,citecolor=black,pdfnewwindow=true,urlcolor=blue,filecolor=blue,baseurl=./]{hyperref}
\usepackage{url}

% \newcommand{\mycite}[2]{\url{#1}{\cite{#2}}}
% \newcommand{\mycite}[2]{\url{#1}:\cite{#2}}
% \newcommand{\mycite}[2]{\href{http://twitter.com/home}{Twitter}.}
%\newcommand{\mycite}[2]{\href{./refs/#1}{\cite{#2}}}
\newcommand{\mycite}[2]{\cite{#2}}
%\newcommand{\myciteurl}[2]{\href{#1}{\cite{#2}}}


\usepackage{amssymb}
\setcounter{tocdepth}{3}
\usepackage{graphicx}

\usepackage{url}
%\urldef{\mailsa}\path|{alfred.hofmann, ursula.barth, ingrid.haas, frank.holzwarth,|
%\urldef{\mailsb}\path|anna.kramer, leonie.kunz, christine.reiss, nicole.sator,|
%\urldef{\mailsc}\path|erika.siebert-cole, peter.strasser, lncs}@springer.com|    
%\newcommand{\keywords}[1]{\par\addvspace\baselineskip
%\noindent\keywordname\enspace\ignorespaces#1}

\usepackage{color}
\usepackage{amsmath}
\usepackage[tight]{subfigure}
\usepackage{listings}
\definecolor{darkgray}{rgb}{0.2,0.2,0.2}

\lstset{language=c++,basicstyle=\scriptsize\sffamily,tabsize=2,framexleftmargin=5mm, frame=shadowbox, framesep=3pt,rulesepcolor=\color{darkgray},rulesep=.100pt,keywordstyle=\bf\color{blue},commentstyle=\color{magenta},stringstyle=\color{red},numbers=left,numberstyle=\tiny,numbersep=10pt,breaklines=true,showstringspaces=false,columns=flexible}

\newcommand{\tomas}[1]{{\color{red}{\textbf{Tom: #1}}}}
\newcommand{\stefan}[1]{{\color{magenta}{\textbf{St: #1}}}}
\newcommand{\christian}[1]{{\color{green}{\textbf{Ch: #1}}}}
\newcommand{\tobias}[1]{{\color{bleu}{\textbf{Tob: #1}}}}


\newcommand{\myvec}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\mymat}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\Vx}{\myvec{x}} % position vector
\newcommand{\Vv}{\myvec{v}} % velocity vector
\newcommand{\Va}{\myvec{a}} % acceleration vector
\newcommand{\Vdv}{\myvec{dv}} % change of velocity vector (unknown in implicit CG, and used in constraint solver)
\newcommand{\deriv}[2]{\frac{\partial #1}{\partial #2}} % Partial derivative


% \newcommand{\mysubsection}[1]{\noindent \textbf{#1: }}
\newcommand{\mysubsection}[1]{\textbf{#1: }}
% \newcommand{\mysubsection}[1]{\subsection{#1}}

%\usepackage{miseenpage}

\begin{document}

\mainmatter            % start of your contributions

\title{Towards planning of infantile cardiac surgery based on simulation}

\author{PaperID:} % TODO

\maketitle

\begin{abstract}
% TODO
\end{abstract}

\section{Introduction}

TODO: Include only a few sentences to CHD in general.

Surgical interventions in infants with congenitally malformed great arteries and hearts can be difficult due to their disease pattern's complex and heterogeneous nature. Today, patient-specific 3-dimensional heart models can be acquired by modern techniques of non-invasive imaging and image post-processing [REFERENCE]. Nevertheless, cardiac surgeons tend to rely solely on subsets or 2-dimensional views of obtained 3-dimensional image data for examination. Possible appropriate surgical procedures may be sketched conceptually and the most promising approach is chosen just in time during the actual open-heart operation. This is the first time the surgeon gets a concrete idea of possible outcomes for different surgical procedures. However, his decision has to be made in relatively short time and can still be based heavily on imagination capabilities and experience.

To improve planning of these kind of cardiac surgeries, obtained 3-dimensional heart models could be used as input for patient-specific surgical simulation systems. Present simulation systems focus on low-level surgical procedures [REFERENCES], i.e. performing actual incisions and suturing with special input devices in real-time. Their purpose is either by means of educational training or planning access strategies to reach the heart's or blood vessel's malformations. It is more important in such \emph{reactive} simulation systems to enable simulations in real-time than to simulate tissue and blood vessels in a physically accurate manner. 

To be able to predict the result of complex surgical procedures, a physically correct simulation model must be used. [REFERENCE] present a \emph{predictive} surgical simulation system for bidirectional Glenn shunts and basically similar surgeries. They use a hybrid model to simulate deformations of blood vessel trees by binding a surface mesh to a reference Cosserat rod elastically. While the mesh models surface details of blood vessels, the Cosserat rod models global deformations, i.e. stretching, bending, twisting and shearing. Low-level surgical procedures are done automatically by the software with only a minimum of interaction required which allows the surgeon to focus on the actual overall surgical procedure. Furthermore the authors show that they can attach triangular shaped patches at loose ends of dissected vessels to allow joining of vessels with different circumferences. Given the input of the surgeon, a typical simulation takes only seconds to produce a predictive result for further examination and evaluation of possibly undesired collisions or deformations of blood vessels. Although the results are promising, the author's method is limited to uniform tubular structures and operations on them, i.e. joining blood vessels end-to-end or end-to-side. Connection of blood vessels is done by using springs. This approach introduces surplus energy to the physical system and special care has to be taken during the simulation to compensate for that. Surgical procedures heavily changing surface details of blood vessels, i.e. arbitrary shaped patches to correct complicated coarctations and stenosis, are not possible with this hybrid model because the blood vessel's physical behavior is simulated by the Cosserat rod and its \emph{binding} to the surface mesh. The authors state that more sophisticated physical models including finite element methods and thin shell elements would allow this but are computationally too expensive to produce results in reasonable time.

In this paper we present an alternative, universal approach using a simulation model solely based on elastic thin shell elements. Our method is not limited to well-formed blood vessels and captures all low-level surgical procedures necessary for aortoplasty. By using a relaxation process we arbitrarily join or attach blood vessels and patches anywhere without using springs that would add surplus energy to the physical system. We prove that simulation time can be expected to be still reasonable or even decreased by taking special care of the blood vessel's overall tubular structure during generation of thin shell elements.

TODO: Structure of Paper.

\section{Blood Vessel Model}

Several different models are commonly used for modelling thin structures or
tubular-like structures resembling blood vessels. \tomas{Add refs. or
reformulate!}
We choose to use thin shell elements for the predictive
simulation of the surgery. Shell elements are often considered numerically
too expensive, this is however not necessarily true.

The formulation of the thin shell elements is based on the mechanics of
continuum and these elements are commonly used in physics and mechanics for
deformation modelling of thin structures.

\tomas{TODO}
\noindent
briefly, refer to some textbook,
Eq. showing dependence on rest position:
simple $\myvec{f} = K(\myvec{x} - \myvec{x_0})$

\ldots

From our point of view, there are several requirements that the model
should be able to fulfill. Namely:

\begin{itemize}
  \item good support for deformations by bending and twisting
  \item the results of the deformation should be global
  \item method should allow arbitrary models and not rely on specific
  structure of the object (e.g. on tubular structure like \cite{Li2009})
  \item the model has to be able to deal with collisions (e.g. between the
  aortic arch and pulmonary artery)
\end{itemize}

Simulation using shell model satisfies all these requirements very well.

\tomas{TODO}
\noindent Test with tube + convergence
\begin{itemize}
  \item experimented with Olivier's model \cite{Comas2010b,Comas2010c} and
  our own model, in principle the shell implementation is not that
  important
  \item geometrical tool, independence on physical parameters -- E
\end{itemize}

% }}}

\section{Simulation of Surgical Procedures}

\noindent surgical low-level tasks done with rest position trick (joining, patch, complex cutting/suturing)
\begin{itemize}
  \item describe the particular tasks and show that the essence is the same,
  \item describe our method with all the tricks
  \item include a schematic illustration
\end{itemize}

\section{Results and Discussion}

Example with 3 diff. surgical procedures

Parameters

Limitations (getting image data, meshes, dynamic remeshing, same number of nodes)

\section{Conclusion}

%\begin{abstract}
%% TODO
%In this paper...
%\end{abstract}
%
%\section{Introduction} % {{{
%
%%%%%%%
%%
%%\christian{We can put any comment...}
%%\tomas{People have different colors}
%%
%%Position vector: $\Vx$
%%
%%Matrices are written as $\mymat{M}$
%%
%%%%%%%
%
%The congenital heart diseases have become quite common \tomas{\ldots}.
%While they are very much treatable there are a lot of difficulties involved
%with the process. There is rarely only a single flaw, the lesions usually
%appear in multiples. Since most of the lesions would be fatal if untreated
%the first surgery has to be performed shortly after the birth, often
%followed with several other surgeries before the age of one year. At such
%young age the heart and blood vessels are very small which requires skills
%of the surgeon. Further more many of the critical decisions cannot be
%concluded from the CT scan or artificial model and have to be done on site
%(e.g. how exactly perform the cut and stitching). This is however in direct
%contrast with the requirement on the speed at which the operation has to be
%performed. During the surgery the blood flow has to be sustained by other
%means (\tomas{pig's heart?}) which puts overall pressure on the organism
%and thus cannot be kept for too long.
%
%\tomas{interesting ref. \cite{Barron2012}}
%
%\tomas{Stefan, please review this. It is just the notion that I have got
%about the problem and might not be completely correct}
%
%For these reasons there is a demand for tools helping with the
%process of pre-operative planning.
%\tomas{Usefulness of computer aid --
%numerical models:
%3D visualisation: Hemminger2005}
%
%\tomas{Are there other approaches to this or similar problem? My search
%did not reveal anything interesting.}
%
%Some of the most common actions in the procedure are
%
%\begin{itemize}
%    \item cutting out a piece of a blood vessel to remove an obstruction or
%    unwanted junction,
%    \item opening a narrow vessel by a cut and closing the hole by an
%    artificial material.
%    \item \tomas{more ideas?}
%\end{itemize}
%
%\tomas{add images}
%
%Both procedures are complicated from the surgeons point of view. In the
%first case the surgeon has to make an educated guess how to perform a cut
%so that after stitching the rest together the blood flow is not obstructed
%and the blood pressure at the seam is not too large so as to tear open the
%vessel. In the second case the surgeon has no prior idea about the shape
%and size of the patch he will need until he performs the cut. Therefor the
%patch has to be cut on site and cannot be prepared in advance.
%
%We are proposing new approach to pre-operative planning of cardiac surgery.
%Using shell elements to model deformations of the blood vessel we help with
%the decision making.
%
%% }}}
%
%\section{Elastic Shell Elements}
%
%To model the blood vessels we employed shell elements in the corotational
%environment. The main advantage of shells is their physical accuracy. They
%are based on the mechanics of continuum. Also the parameters defining the
%parameters of the simulation have clear physical interpretation (unlike for
%example for mass-spring model).
%
%
%The common objection against using shell elements in real-time simulations
%is the numerical complexity. While this is technically valid, it is not
%good enough reason. Using low resolution mesh we can obtain results with
%good visual and physical accuracy sufficient for real-time
%simulation.\tomas{isn't this too strong?} Given the bending nature of the
%shell one can employ interpolation of the shell surface to improve the
%visual mesh presented to the user. \tomas{cite Olivier and our unpublished
%results}
%
%A shell element is a combination of two other elements: elastic membrane
%and bending plate element. While the membrane element is used to compute
%in-plane forces of the shell (like stretching or shearing), the bending
%plate elements on the other hand describes the bending properties.
%
%\tomas{add image showing the difference}
%
%\tomas{thin in one dimension}
%
%\subsection{Mechanics of Continuum Preliminaries} % {{{
%
%\tomas{recheck this. btw do we really want this?}
%
%The mathematical formulation follows the steps defined by the mechanics of
%continuum.\tomas{ref. to some text book}
%
%For every particle $\myvec{x} \in \Omega$ of the deformable body $\Omega$
%the deformation $ \phi : \Omega' \to \Omega $ is a mapping from the rest
%shape $\myvec{x}' \in \Omega'$ to it's current shape
%
%$$ \phi(x) = \myvec{x}' + u(x) $$
%
%Where $u(x)$ is the displacement for particle $x$. From the Cauchy's strain
%tensor
%
%$$
%\epsilon = \frac{1}{2}\left( \nabla^T u + \nabla u \right)
%$$
%
%\noindent%
%we can compute the stress by applying a constitutive law. In our simulation
%we are using linear Hooke's law to keep the numerical formulation simple
%enough to be able to compute it in real-time. The stress is computed by
%
%$$
%\sigma = \mymat{M}\epsilon
%$$
%
%\noindent%
%where $\mymat{M}$ is the material matrix. Further from the stress and
%strain we can compute the strain energy
%
%$$
%E = \int_{\Omega} \epsilon^T \sigma \,\mathrm{d}\Omega
%$$
%
%\tomas{now should be discretization}
%
%%}}}
%
%\subsection{shells...} % {{{
%
%In this subsection we will briefly summarize how the numerical formulation
%of the linear model is derived. For more thorough description we refer the
%reader to \tomas{add ref.} Let's define $ u_x, u_y $ to be the two
%in-plane displacements and $ u_z $ the off-plane function of deflection. We
%define the strain-displacement matrices in the following way. For the
%membrane element (using the Cauchy's strain tensor)
%
%\begin{equation}
%  \mymat{B_m} = \left[ \begin{matrix}
%    \deriv{u_x}{x} \\
%    \deriv{u_y}{y} \\
%    \deriv{u_x}{y} + \deriv{u_y}{x}
%  \end{matrix} \right]
%\end{equation}
%
%\noindent%
%and for the bending plate element (using the Kirchoff-Love theory)
%
%\begin{equation}
%  \mymat{B_b} = \left[ \begin{matrix}
%    - z \deriv{^2 u_z}{x^2} \\
%    - z \deriv{^2 u_z}{y^2} \\
%    - 2z \deriv{^2 u_z}{xy}
%  \end{matrix} \right]
%\end{equation}
%
%From these we can easily compute the stiffness matrices $K_m$ and $K_b$
%(for membrane and bending plate element respectively) by integrating over
%the volume of the shell
%
%\begin{equation}
%  \mymat{K}_i = \int_V \mymat{B}_i^T \mymat{M} \mymat{B}_i \,\mathrm{d}V
%\end{equation}
%
%\noindent%
%where $i \in \{\mathrm{b},\mathrm{m}\}$ and $\mymat{M}$ is the material
%matrix defined by Hooke's law:
%
%\begin{equation}
%  \mymat{M} = \frac{E}{1-\nu^2} \left[ \begin{matrix}
%    1   & \nu & 0 \\
%    \nu & 1   & 0 \\
%    0   & 0   & \frac{1-\nu}{2}
%  \end{matrix} \right]
%\end{equation}
%
%The only two values defining the matrix value are Poisson's ratio $\nu$ and
%the Young's modulus $E$.
%
%% }}}
%
%\subsection{Co-rotational Formulation}
%
%While the Cauchy's strain used in the formulation of the shell element is
%invariant to rigid body translation, it is known to be rotationally
%noninvariant. This produces ghost deformations just by rigid rotation. One
%way to solve the problem is using Green's strain tensor instead whose
%definition is, however, non-linear. Therefore we to overcome the problem we
%chose to use the corotational formulation instead.\tomas{add ref;
%maybe short description?}
%
%
%\section{Method Description} % {{{
%
%\tomas{clearly state that this is not a complete solution where user points
%and clicks -- it's just a proof-of-concept}
%
%In this chapter we will elaborate on the internal aspects of the
%simulation.
%
%Outline:
%
%\begin{itemize}
%    \item we use shell elements to model blood vessels, dynamic system
%        (implicit integration), in Sofa framework \tomas{cite Olivier
%        \cite{Comas2010b,Comas2010c} -- shells in corotational environment}
%    \item using springs to connect the objects is not good --> generates
%        excessive amount of energy
%    \item to eliminate this we use one mesh for the simulation and
%        different mesh to describe the rest shape and we leave the dynamic
%        system to stabilize
%        -- we need to map the nodes between topologies
%    \item to reduce more the generation of excessive energies in the system
%        at the beginning of the simulation we repetitively change the rest
%        shape (linear interpolation)
%\end{itemize}
%
%We are aiming for non-interactive simulation without requiring the
%surgeon to go through the whole process of the surgery. This introduces several
%problems we have to deal with.
%
%The first problem is how to deform the model so that the requested parts
%can be sutured together. And second how to simulate the suture.
%The simplest solution here would be connecting the respective nodes
%together with springs. Such solution, however, has a disadvantage of adding
%excessive energies to the system.\tomas{do we need a ref.?}
%
%We propose a different approach which uses a two different mesh topologies.
%The basic idea is to transform the mesh by joining the edges and nodes
%where the suturing is supposed to take place and let the dynamic system
%find a stable configuration. Such stable configuration is the result we are
%looking for. This requires us to provide a mapping to the underlying shell
%element code that would translate between nodes of the topology of the rest
%shape and the topology of the deformed mesh. Such a mapping is 1:N for
%nodes where the suturing takes place. \tomas{add image} To make it properly
%defined elements have to be taken into account also:
%
%\begin{equation}
%  \phi : N_d \times E_d -> N_r
%\end{equation}
%
%In the definition of this mapping $\phi$ the $N_d$ and $E_d$ are sets of
%nodes and elements of the deformed mesh and $N_r$ is set of nodes of the
%deformed mesh.
%
%\tomas{what more?}
%
%
%Another problem that a predictive simulation should deal with is filling
%the missing steps that would normally had to be performed fluently by the
%surgeon. For example when suturing two blood vessels together they have to
%be placed close to one another first. Sometimes relatively large distances
%have to be overcome. By ignoring this fact our approach with joining nodes
%and edges could generate unwanted forces at the start of the simulation. To
%alleviate large initial deformations for the elements we employed
%interpolation ...
%
%
%% }}}
%
%\section{Conclusion}
%%\subsection{Verification}
%
%Verification is difficult -- limited or no knowledge of real state after
%the surgery (too risky to put the child under CT/MRI again). 
%
%Therefore we are interested in the geometrical evaluation of the result
%i.e. no excessive elongations, expected deformations, independence on
%physical parameters (E/nu),\ldots or something like that \ldots


\bibliographystyle{abbrv}
\bibliography{miccai2012}

\end{document}

% Some Vim setup. If it interferes with anyones work feel free to remove
% that.
% vim: et sw=2 tw=75 fdm=marker fdc=2 spell

<?xml version="1.0"?>
<Node name="Root Node" dt="0.01" gravity="0 0 0" >

    <VisualStyle displayFlags="showVisual" />

    <Node name="MeshOriginal">
        <MeshObjLoader name="loader" filename="cylinder1.obj"/>
        <Vertex2Frame name="frames" template="Rigid"
            position="@loader.position" normals="@loader.normals"
            invertNormals="false"/>
    </Node>

    <!-- We use the map to combine the nodes -->
    <Node name="Mesh">
        <JoinMeshPoints template="Rigid" name="join" src="@/MeshOriginal/loader" joinPoints="
            0 48
            1 49
            2 50
            3 51
            4 52
            5 53
            6 54
            7 55
            " />
        <Vertex2Frame name="framesS" template="Rigid" position="@join.mergedPosition" normals="@join.mergedNormals" />
        <Vertex2Frame name="framesJ" template="Rigid" position="@join.joinedPosition" normals="@join.joinedNormals" />
    </Node>

    <Node name="Cylinder">
        <!-- Rest shape interpolation -->
        <MeshInterpolator template="Rigid" name="interp"
            startPosition="@/Mesh/framesS.frames"
            endPosition="@/MeshOriginal/frames.frames"
            nbSteps="10"
            increment="0.05" />

        <EulerImplicit />
        <!--
        <CGLinearSolver name="CG Linear Solver" iterations="200" tolerance="1.0e-9" threshold="1.0e-9"/>
        -->
        <SparseLDLSolver />


        <TriangleSetTopologyContainer
            position="@/Mesh/join.joinedPosition"
            triangles="@/Mesh/join.joinedTriangles" />
        <MechanicalObject name="MO" template="Rigid" rest_position="@/Mesh/framesJ.frames" />

        <BoxROI name="fixed1" box="-1 3.59 -1   1 3.61 1" drawBoxes="true" />
        <BoxROI name="fixed2" box="-1 -1.01 -1   1 -0.99 1" drawBoxes="true" />
        <FixedConstraint indices="@fixed1.indices" />
        <FixedConstraint indices="@fixed2.indices" />

        <UniformMass showAxisSizeFactor="0.1" totalMass="1" />

        <!--
        <FixedRotationConstraint FixedZRotation="true" />
        -->
        <TriangularBendingFEMForceField name="FEM" bending="true"
            youngModulus="1e7"
            poissonRatio="0.33"
            thickness="0.01"

            restShape="@interp"
            topologyMapper="@/Mesh/join"
            />

        <Node>
            <OglModel name="Visual1" color="green"/>
            <IdentityMapping input="@.." output="@Visual1"/>
        </Node>

        <MeshExporter filename="cyl1-E1e7" format="gmsh"
            quads="0" tetras="0" hexas="0"
            listening="true"
            exportAtBegin="0" exportAtEnd="1" />

    </Node>

</Node>
